{"version":3,"sources":["../../../src/local/grades/new_unified_grader.js"],"names":["templateNames","grader","app","getHelpers","config","graderLayout","graderContainer","displayUsers","html","Templates","replaceNode","Selectors","regions","gradingReplace","getUsers","cmid","getUsersForCmidFunction","catch","Notification","exception","renderUserPicker","state","userNames","map","user","firstname","lastname","userid","id","picker","UserPaginator","buildPicker","registerEventListeners","addEventListener","e","target","matches","buttons","toggleFullscreen","stopImmediatePropagation","preventDefault","closeGrader","close","displayGrader","fullscreen","getContainer","render","then","js","replaceNodeContents","console","log","querySelector","moduleReplace","users","hideLoadingIcon","launch"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module will tie together all of the different calls the gradable module will make.\n *\n * @module     core_grades/unified_grader\n * @package    core_grades\n * @copyright  2019 Mathew May <mathew.solutions>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport Selectors from './selectors';\nimport * as UserPaginator from './new_unified_grader_user_paginator';\nimport {createLayout as createFullScreenWindow} from 'mod_forum/local/layout/fullscreen';\n\nconst templateNames = {\n    grader: {\n        app: 'mod_forum/local/grades/unified_grader/grading_app',\n    },\n};\n\nconst getHelpers = (config) => {\n    let graderLayout = null;\n    let graderContainer = null;\n    let contentRegion = null;\n\n    /*const displayContent = (html, js) => {\n        let widget = document.createElement('div');\n        widget.className = \"grader-module-content-display col-sm-12\";\n        widget.dataset.replace = \"grader-module-content\";\n        widget.innerHTML = html;\n        return Templates.replaceNode(Selectors.regions.moduleReplace, widget, js);\n    };*/\n\n    const displayUsers = (html) => {\n        return Templates.replaceNode(Selectors.regions.gradingReplace, html);\n    };\n\n    // Remove from bottom section userpicker rendered up top\n    const getUsers = (cmid) => {\n        return config\n            .getUsersForCmidFunction(cmid)\n            .catch(Notification.exception);\n    };\n    /*const showUser = (userid) => {\n        config\n            .getContentForUserId(userid)\n            .then(displayContent)\n            .catch(Notification.exception);\n    };*/\n\n    const renderUserPicker = (state) => {\n        const userNames = state.map(user => ({firstname: user.firstname, lastname: user.lastname, userid: user.id}));\n        const picker = UserPaginator.buildPicker(userNames, 0);\n        return picker;\n\n    };\n    const registerEventListeners = () => {\n        graderContainer.addEventListener('click', (e) => {\n            if (e.target.matches(Selectors.buttons.toggleFullscreen)) {\n                e.stopImmediatePropagation();\n                e.preventDefault();\n\n                graderLayout.toggleFullscreen();\n            } else if (e.target.matches(Selectors.buttons.closeGrader)) {\n                e.stopImmediatePropagation();\n                e.preventDefault();\n\n                graderLayout.close();\n            }\n        });\n    };\n\n    const displayGrader = () => {\n        graderLayout = createFullScreenWindow({fullscreen: false});\n        graderContainer = graderLayout.getContainer();\n\n        return Templates.render(templateNames.grader.app, {})\n            .then((html, js) => {\n                Templates.replaceNodeContents(graderContainer, html, js);\n\n                return graderContainer;\n            })\n            .then(() => {\n                // Set user picker\n                console.log('1');\n                contentRegion = graderContainer.querySelector(Selectors.regions.moduleReplace);\n                return;\n            })\n            .then(() => {\n                console.log('2');\n                registerEventListeners();\n\n                return;\n            })\n            .then(() => {\n                console.log('3');\n                getUsers(config.cmid)\n                    .then(state => {\n                        console.log('4');\n                        renderUserPicker(state.users)\n                            .then((picker) => {\n                                displayUsers(picker);\n                            });\n                    })\n                    .catch();\n            })\n            .then(() => {\n                graderLayout.hideLoadingIcon();\n                return;\n            })\n            .catch();\n    };\n\n    return {\n        displayGrader,\n    };\n};\n\n// Make this explicit rather than object\nexport const launch = (config) => {\n    const {\n        displayGrader,\n    } = getHelpers(config);\n\n    displayGrader();\n};\n"],"file":"new_unified_grader.min.js"}