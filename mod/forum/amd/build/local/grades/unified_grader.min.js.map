{"version":3,"sources":["../../../src/local/grades/unified_grader.js"],"names":["templateNames","grader","app","getHelpers","config","graderLayout","graderContainer","displayUsers","html","Templates","replaceNode","Selectors","regions","gradingReplace","getUsers","cmid","getUsersForCmidFunction","catch","Notification","exception","renderUserContent","index","user","node","rootNode","nodeReplace","querySelector","moduleReplace","showLoadingIcon","getContentForUserId","id","then","hideLoadingIcon","js","widget","document","createElement","className","dataset","replace","innerHTML","renderUserPicker","state","userNames","map","firstname","lastname","userid","picker","UserPaginator","createPicker","registerEventListeners","addEventListener","e","target","matches","buttons","toggleFullscreen","stopImmediatePropagation","preventDefault","closeGrader","close","displayGrader","fullscreen","getContainer","render","replaceNodeContents","child","lastElementChild","removeChild","launch","users"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module will tie together all of the different calls the gradable module will make.\n *\n * @module     core_grades/unified_grader\n * @package    core_grades\n * @copyright  2019 Mathew May <mathew.solutions>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport Selectors from './selectors';\nimport * as UserPaginator from './unified_grader_user_paginator';\nimport {createLayout as createFullScreenWindow} from 'mod_forum/local/layout/fullscreen';\nimport {addIconToContainer} from 'core/loadingicon';\n\nconst templateNames = {\n    grader: {\n        app: 'mod_forum/local/grades/unified_grader/grading_app',\n    },\n};\n\nconst getHelpers = (config) => {\n    let graderLayout = null;\n    let graderContainer = null;\n\n    /*const displayContent = (html, js) => {\n        let widget = document.createElement('div');\n        widget.className = \"grader-module-content-display col-sm-12\";\n        widget.dataset.replace = \"grader-module-content\";\n        widget.innerHTML = html;\n        return Templates.replaceNode(Selectors.regions.moduleReplace, widget, js);\n    };*/\n\n    const displayUsers = (html) => {\n        return Templates.replaceNode(Selectors.regions.gradingReplace, html);\n    };\n\n    const getUsers = (cmid) => {\n        return config\n            .getUsersForCmidFunction(cmid)\n            .catch(Notification.exception);\n    };\n    /*const showUser = (userid) => {\n        config\n            .getContentForUserId(userid)\n            .then(displayContent)\n            .catch(Notification.exception);\n    };*/\n\n    const renderUserContent = (index, user) => {\n        // Add loading icon here.\n        const node = config.rootNode;\n        const nodeReplace = node.querySelector(Selectors.regions.moduleReplace);\n        showLoadingIcon(nodeReplace);\n        config.getContentForUserId(user.id)\n            .then(() => {\n                const node = config.rootNode;\n                const nodeReplace = node.querySelector(Selectors.regions.moduleReplace);\n                hideLoadingIcon(nodeReplace);\n            })\n            .then((html, js) => {\n                let widget = document.createElement('div');\n                widget.className = \"grader-module-content-display col-sm-12\";\n                widget.dataset.replace = \"grader-module-content\";\n                widget.innerHTML = html;\n                return Templates.replaceNode(Selectors.regions.moduleReplace, widget, js);\n            })\n            .catch();\n    };\n\n    const renderUserPicker = (state) => {\n        const userNames = state.map(user => ({firstname: user.firstname, lastname: user.lastname, userid: user.id}));\n        const picker = UserPaginator.createPicker(userNames, 0, renderUserContent);\n        return picker;\n\n    };\n    const registerEventListeners = () => {\n        graderContainer.addEventListener('click', (e) => {\n            if (e.target.matches(Selectors.buttons.toggleFullscreen)) {\n                e.stopImmediatePropagation();\n                e.preventDefault();\n\n                graderLayout.toggleFullscreen();\n            } else if (e.target.matches(Selectors.buttons.closeGrader)) {\n                e.stopImmediatePropagation();\n                e.preventDefault();\n\n                graderLayout.close();\n            }\n        });\n    };\n\n    const displayGrader = () => {\n        graderLayout = createFullScreenWindow({fullscreen: false});\n        graderContainer = graderLayout.getContainer();\n\n        return Templates.render(templateNames.grader.app, {})\n        .then((html, js) => {\n            Templates.replaceNodeContents(graderContainer, html, js);\n\n            return graderContainer;\n        })\n        .then(() => {\n            graderLayout.hideLoadingIcon();\n\n            return;\n        })\n        .then(() => {\n            registerEventListeners();\n\n            return;\n        })\n        .catch();\n    };\n\n    const showLoadingIcon = (node) => {\n        addIconToContainer(node);\n    };\n\n    const hideLoadingIcon = (node) => {\n        // Hide the loading container.\n        let child = node.lastElementChild;\n        while (child) {\n            node.removeChild(child);\n            child = node.lastElementChild;\n        }\n    };\n\n    return {\n        getUsers,\n        renderUserPicker,\n        displayUsers,\n        registerEventListeners,\n        displayGrader,\n    };\n};\n\nexport const launch = (config) => {\n    const {\n        getUsers,\n        renderUserPicker,\n        displayUsers,\n        registerEventListeners,\n        displayGrader,\n    } = getHelpers(config);\n\n    displayGrader().then(() => {\n\n        getUsers(config.cmid)\n            .then(state => {\n                renderUserPicker(state.users)\n                    .then((picker) => {\n                        displayUsers(picker);\n                });\n            })\n            .catch();\n\n        registerEventListeners();\n    })\n    .catch();\n};\n"],"file":"unified_grader.min.js"}