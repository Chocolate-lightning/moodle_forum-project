{"version":3,"sources":["../src/filters.js"],"names":["init","root","document","ready","hide","removeClass","on","event","target","parentNode","parentElement","find","prop","generateWithFilters","preventDefault","filterParams","search","substr","newLink","attr","click","setGroupFilterText","groupCount","stringName","Str","get_string","groupButtonText","text","filterValue","value","id","each","val","referenceElement","querySelector","popperContent","Popper","placement","addClass","groupsCount","length"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module responsible for handling forum summary report filters.\n *\n * @module     forumreport_summary/filters\n * @package    forumreport_summary\n * @copyright  2019 Michael Hawkins <michaelh@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Popper from 'core/popper';\nimport * as Str from 'core/str';\n\nexport const init = (root) => {\n    root = $(root);\n\n    // Hide loading spinner and show report once page is ready.\n    // This ensures filters can be applied when sorting by columns.\n    $(document).ready(function() {\n        $('.loading-icon').hide();\n        $('#summaryreport').removeClass('d-none');\n    });\n\n    /**\n     * Generic filter handlers.\n     */\n\n    // Event handler to clear filters.\n    $(root).on(\"click\", \".filter-clear\", function(event) {\n        // Uncheck any checkboxes.\n        $(event.target.parentNode.parentElement).find('input[type=checkbox]:checked').prop(\"checked\", false);\n\n        // Check the default checkbox.\n        $(event.target.parentNode.parentElement).find('input[type=checkbox][value=\"0\"]').prop(\"checked\", true);\n    });\n\n    // Called to override click event to trigger a proper generate request with filtering.\n    var generateWithFilters = event => {\n        event.preventDefault();\n\n        var filterParams = event.target.search.substr(1),\n            newLink = $('#generatereport').attr('formaction') + '&' + filterParams;\n\n        $('#generatereport').attr('formaction', newLink);\n        $('#generatereport').click();\n    };\n\n    // Override 'reset table preferences' so it generates with filters.\n    $('.resettable').on(\"click\", \"a\", function(event) {\n        generateWithFilters(event);\n    });\n\n    // Override table heading sort links so they generate with filters.\n    $('thead').on(\"click\", \"a\", function(event) {\n        generateWithFilters(event);\n    });\n\n    // Override pagination page links so they generate with filters.\n    $('.pagination').on(\"click\", \"a\", function(event) {\n        generateWithFilters(event);\n    });\n\n    /**\n     * Groups filter specific handlers.\n     */\n\n    // Set groups filter button text to include relevant item count (or 'all').\n    var setGroupFilterText = async (groupCount) => {\n        let stringName = 'groupscountnumber';\n\n        if (!groupCount || $('#filtergroups0').prop(\"checked\")) {\n            stringName = 'groupscountall';\n        }\n\n        const groupButtonText = await Str.get_string(stringName, 'forumreport_summary', groupCount);\n        $('#filter_groups_button').text(groupButtonText);\n    };\n\n    // Control groups filter rules around 'all' option.\n    $('#filter-groups-popover input[name=\"filtergroups[]\"]').on('click', function(event) {\n        // If checking 'all', uncheck others.\n        var filterValue = event.target.value;\n\n        // Uncheck other groups if 'all' selected.\n        if (filterValue == 0) {\n            if ($('#' + event.target.id).prop('checked')) {\n                $(event.target.parentNode).find('input[name=\"filtergroups[]\"]:checked').each(function() {\n                    if ($(this).val() != 0) {\n                        $(this).prop('checked', false);\n                    }\n                });\n            } else {\n                // Don't allow unchecking of 'all' directly.\n                $('#' + event.target.id).prop('checked', true);\n            }\n        } else {\n            // Uncheck 'all' if another group is checked.\n            $('#filtergroups0').prop('checked', false);\n        }\n    });\n\n    // Event handler for showing groups filter popover.\n    $('#filter_groups_button').on('click', function() {\n        // Create popover.\n        var referenceElement = document.querySelector('#filter_groups_button'),\n            popperContent = document.querySelector('#filter-groups-popover');\n\n        new Popper(referenceElement, popperContent, {placement: 'bottom'});\n\n        // Show popover.\n        $('#filter-groups-popover').removeClass('d-none');\n    });\n\n    // Event handler to save groups filter.\n    $(root).on(\"click\", \".form-group > .filter-save\", function() {\n        // Close the popover.\n        $('#filter-groups-popover').addClass('d-none');\n\n        // Update group count on button.\n        var groupsCount = $('#filter-groups-popover').find('input[name=\"filtergroups[]\"]:checked').length;\n        setGroupFilterText(groupsCount);\n    });\n};\n"],"file":"filters.min.js"}