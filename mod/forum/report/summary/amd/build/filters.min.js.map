{"version":3,"sources":["../src/filters.js"],"names":["init","root","jqRoot","document","ready","hide","removeClass","generateWithFilters","event","newLink","attr","preventDefault","filterParams","target","search","substr","submit","on","submitWithFilter","containerelement","Y","use","M","core_formchangechecker","reset_form_dirty_state","addClass","updateCalendarPosition","referenceElement","querySelector","Selectors","filters","date","popover","popperContent","calendar","Popper","placement","closeOpenFilters","openFilterButton","openFilter","classList","add","setAttribute","remove","CustomEvents","events","activate","group","selectall","deselected","querySelectorAll","checkbox","forEach","checked","clear","selected","trigger","closeListener","e","id","closest","removeEventListener","escCloseListener","addEventListener","keyCode","KeyCodes","escape","save","popcheckboxes","popcheckbox","filtersform","forms","saveid","getAttribute","focus","filtersForm","datesPopover","dateFromObj","value","dateToObj","request","methodname","args","datefrom","dateto","Ajax","call","done","result","warnings","length","warningDiv","getElementById","textContent","message","elements","timestampfrom","timestampto","enabled","warningdiv"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module responsible for handling forum summary report filters.\n *\n * @module     forumreport_summary/filters\n * @package    forumreport_summary\n * @copyright  2019 Michael Hawkins <michaelh@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Popper from 'core/popper';\nimport CustomEvents from 'core/custom_interaction_events';\nimport Selectors from 'forumreport_summary/selectors';\nimport Y from 'core/yui';\nimport Ajax from 'core/ajax';\nimport KeyCodes from 'core/key_codes';\n\nexport const init = (root) => {\n    let jqRoot = $(root);\n\n    // Hide loading spinner and show report once page is ready.\n    // This ensures filters can be applied when sorting by columns.\n    $(document).ready(function() {\n        $('.loading-icon').hide();\n        $('#summaryreport').removeClass('hidden');\n    });\n\n    // Generic filter handlers.\n\n    // Called to override click event to trigger a proper generate request with filtering.\n    var generateWithFilters = (event) => {\n        var newLink = $('#filtersform').attr('action');\n\n        if (event) {\n            event.preventDefault();\n\n            let filterParams = event.target.search.substr(1);\n            newLink += '&' + filterParams;\n        }\n\n        $('#filtersform').attr('action', newLink);\n        $('#filtersform').submit();\n    };\n\n    // Override 'reset table preferences' so it generates with filters.\n    $('.resettable').on(\"click\", \"a\", function(event) {\n        generateWithFilters(event);\n    });\n\n    // Override table heading sort links so they generate with filters.\n    $('thead').on(\"click\", \"a\", function(event) {\n        generateWithFilters(event);\n    });\n\n    // Override pagination page links so they generate with filters.\n    $('.pagination').on(\"click\", \"a\", function(event) {\n        generateWithFilters(event);\n    });\n\n    // Submit report via filter\n    var submitWithFilter = (containerelement) => {\n        // Disable the dates filter mform checker to prevent any changes triggering a warning to the user.\n        Y.use('moodle-core-formchangechecker', function() {\n            M.core_formchangechecker.reset_form_dirty_state();\n        });\n\n        // Close the container (eg popover).\n        $(containerelement).addClass('hidden');\n\n        // Submit the filter values and re-generate report.\n        generateWithFilters(false);\n    };\n\n    // Use popper to override date mform calendar position.\n    var updateCalendarPosition = () => {\n        let referenceElement = document.querySelector(Selectors.filters.date.popover),\n            popperContent = document.querySelector(Selectors.filters.date.calendar);\n\n        new Popper(referenceElement, popperContent, {placement: 'bottom'});\n    };\n\n    // Close the relevant filter.\n    var closeOpenFilters = (openFilterButton, openFilter) => {\n        openFilter.classList.add('hidden');\n        openFilter.setAttribute('data-openfilter', 'false');\n\n        openFilterButton.classList.add('btn-primary');\n        openFilterButton.classList.remove('btn-outline-primary');\n        openFilterButton.setAttribute('aria-expanded', false);\n    };\n\n    // Groups filter specific handlers.\n\n    // Event handler for clicking select all groups.\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.group.selectall, function() {\n        let deselected = root.querySelectorAll(Selectors.filters.group.checkbox + ':not(:checked)');\n        deselected.forEach(function(checkbox) {\n            checkbox.checked = true;\n        });\n    });\n\n    // Event handler for clearing filter by clicking option.\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.group.clear, function() {\n        // Clear checkboxes.\n        let selected = root.querySelectorAll(Selectors.filters.group.checkbox + ':checked');\n        selected.forEach(function(checkbox) {\n            checkbox.checked = false;\n        });\n    });\n\n    // Event handler for showing groups filter popover.\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.group.trigger, function() {\n        // Create popover.\n        let referenceElement = root.querySelector(Selectors.filters.group.trigger),\n            popperContent = root.querySelector(Selectors.filters.group.popover);\n\n        new Popper(referenceElement, popperContent, {placement: 'bottom'});\n\n        // Show popover.\n        popperContent.classList.remove('hidden');\n        popperContent.setAttribute('data-openfilter', 'true');\n\n        // Change to outlined button.\n        referenceElement.classList.add('btn-outline-primary');\n        referenceElement.classList.remove('btn-primary');\n\n        // Let screen readers know that it's now expanded.\n        referenceElement.setAttribute('aria-expanded', true);\n\n        // Add listeners to handle closing filter.\n        const closeListener = e => {\n            if (e.target.id !== referenceElement.id && popperContent !== e.target.closest('[data-openfilter=\"true\"]')) {\n                closeOpenFilters(referenceElement, popperContent);\n                document.removeEventListener('click', closeListener);\n                document.removeEventListener('keyup', escCloseListener);\n            }\n        };\n\n        document.addEventListener('click', closeListener);\n\n        const escCloseListener = e => {\n            if (e.keyCode === KeyCodes.escape) {\n                closeOpenFilters(referenceElement, popperContent);\n                document.removeEventListener('keyup', escCloseListener);\n                document.removeEventListener('click', closeListener);\n            }\n        };\n\n        document.addEventListener('keyup', escCloseListener);\n    });\n\n    // Event handler to click save groups filter.\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.group.save, function() {\n        // Copy the saved values into the form before submitting.\n        let popcheckboxes = root.querySelectorAll(Selectors.filters.group.checkbox);\n\n        popcheckboxes.forEach(function(popcheckbox) {\n            let filtersform = document.forms.filtersform,\n                saveid = popcheckbox.getAttribute('data-saveid');\n\n            filtersform.querySelector(`#${saveid}`).checked = popcheckbox.checked;\n        });\n\n        submitWithFilter('#filter-groups-popover');\n    });\n\n    // Dates filter specific handlers.\n\n   // Event handler for showing dates filter popover.\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.date.trigger, function() {\n\n        // Create popover.\n        let referenceElement = root.querySelector(Selectors.filters.date.trigger),\n            popperContent = root.querySelector(Selectors.filters.date.popover);\n\n        new Popper(referenceElement, popperContent, {placement: 'bottom'});\n\n        // Show popover and move focus.\n        popperContent.classList.remove('hidden');\n        popperContent.setAttribute('data-openfilter', 'true');\n        popperContent.querySelector('[name=\"filterdatefrompopover[enabled]\"]').focus();\n\n        // Change to outlined button.\n        referenceElement.classList.add('btn-outline-primary');\n        referenceElement.classList.remove('btn-primary');\n\n        // Let screen readers know that it's now expanded.\n        referenceElement.setAttribute('aria-expanded', true);\n\n        // Add listener to handle closing filter.\n        const closeListener = e => {\n            if (e.target.id !== referenceElement.id && popperContent !== e.target.closest('[data-openfilter=\"true\"]')) {\n                closeOpenFilters(referenceElement, popperContent);\n                document.removeEventListener('click', closeListener);\n                document.removeEventListener('keyup', escCloseListener);\n            }\n        };\n\n        document.addEventListener('click', closeListener);\n\n        const escCloseListener = e => {\n            if (e.keyCode === KeyCodes.escape) {\n                closeOpenFilters(referenceElement, popperContent);\n                document.removeEventListener('keyup', escCloseListener);\n                document.removeEventListener('click', closeListener);\n            }\n        };\n\n        document.addEventListener('keyup', escCloseListener);\n    });\n\n    // Event handler to save dates filter.\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.date.save, function() {\n        // Populate the hidden form inputs to submit the data.\n        let filtersForm = document.forms.filtersform;\n        const datesPopover = root.querySelector(Selectors.filters.date.popover);\n        const dateFromObj = {\n                'day': datesPopover.querySelector('[name=\"filterdatefrompopover[day]\"]').value,\n                'month': datesPopover.querySelector('[name=\"filterdatefrompopover[month]\"]').value,\n                'year': datesPopover.querySelector('[name=\"filterdatefrompopover[year]\"]').value,\n                'enabled': datesPopover.querySelector('[name=\"filterdatefrompopover[enabled]\"]').checked ? 1 : 0\n            };\n        const dateToObj = {\n                'day': datesPopover.querySelector('[name=\"filterdatetopopover[day]\"]').value,\n                'month': datesPopover.querySelector('[name=\"filterdatetopopover[month]\"]').value,\n                'year': datesPopover.querySelector('[name=\"filterdatetopopover[year]\"]').value,\n                'enabled': datesPopover.querySelector('[name=\"filterdatetopopover[enabled]\"]').checked ? 1 : 0\n            };\n        const args = {\n                datefrom: dateFromObj,\n                dateto: dateToObj\n            };\n        const request = {\n                methodname: 'forumreport_summary_get_timestamps',\n                args: args\n            };\n\n        Ajax.call([request])[0].done(function(result) {\n            if (result.warnings.length > 0) {\n                // Display the error.\n                let warningDiv = document.getElementById('dates-filter-warning');\n                warningDiv.textContent = result.warnings[0].message;\n                warningDiv.classList.remove('hidden');\n                warningDiv.classList.add('d-block');\n            } else {\n                // Update the elements in the filter form.\n                filtersForm.elements['datefrom[timestamp]'].value = result.timestampfrom;\n                filtersForm.elements['datefrom[enabled]'].value =\n                        datesPopover.querySelector('[name=\"filterdatefrompopover[enabled]\"]').checked ? 1 : 0;\n                filtersForm.elements['dateto[timestamp]'].value = result.timestampto;\n                filtersForm.elements['dateto[enabled]'].value =\n                        datesPopover.querySelector('[name=\"filterdatetopopover[enabled]\"]').checked ? 1 : 0;\n\n                // Submit the filter values and re-generate report.\n                submitWithFilter('#filter-dates-popover');\n            }\n        });\n\n        if (!dateFromObj.enabled && !dateToObj.enabled) {\n            // Update the elements in the filter form.\n            filtersForm.elements['datefrom[timestamp]'].value = 0;\n            filtersForm.elements['datefrom[enabled]'].value = dateFromObj.enabled;\n            filtersForm.elements['dateto[timestamp]'].value = 0;\n            filtersForm.elements['dateto[enabled]'].value = dateToObj.enabled;\n\n            // Submit the filter values and re-generate report.\n            submitWithFilter('#filter-dates-popover');\n        } else {\n            Ajax.call([request])[0].done(function(result) {\n                if (result.warnings.length > 0) {\n                    // Display the error.\n                    let warningdiv = document.getElementById('dates-filter-warning');\n                    warningdiv.textContent = result.warnings[0].message;\n                    warningdiv.classList.remove('hidden');\n                    warningdiv.classList.add('d-block');\n                } else {\n                    filtersForm.elements['datefrom[timestamp]'].value = result.timestampfrom;\n                    filtersForm.elements['datefrom[enabled]'].value = dateFromObj.enabled;\n                    filtersForm.elements['dateto[timestamp]'].value = result.timestampto;\n                    filtersForm.elements['dateto[enabled]'].value = dateToObj.enabled;\n\n                    // Submit the filter values and re-generate report.\n                    submitWithFilter('#filter-dates-popover');\n                }\n            });\n        }\n    });\n\n    jqRoot.on(\"click\", \"#id_filterdatefrompopover_calendar\", function() {\n        updateCalendarPosition();\n    });\n\n    jqRoot.on(\"click\", \"#id_filterdatetopopover_calendar\", function() {\n        updateCalendarPosition();\n    });\n};\n"],"file":"filters.min.js"}