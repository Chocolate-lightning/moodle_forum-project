{"version":3,"sources":["../src/filters.js"],"names":["define","$","Popper","str","init","document","on","event","target","parentNode","parentElement","find","prop","generateWithFilters","preventDefault","filterParams","search","substr","newLink","attr","click","setGroupFilterText","groupCount","allString","get_string","when","done","toLowerCase","text","val","filterValue","value","id","each","referenceElement","querySelector","popperContent","placement","removeClass","addClass","groupsCount","length"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module responsible for handling forum summary report filters.\n *\n * @module     forumreport_summary/filters\n * @package    forumreport_summary\n * @copyright  2019 Michael Hawkins <michaelh@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/popper', 'core/str'], function($, Popper, str) {\n\n    return {\n        init: function() {\n\n            /**\n             * Generic filter handlers.\n             */\n\n            // Event handler to clear filters.\n            $(document).on(\"click\", \".filter-clear\", function(event) {\n                // Uncheck any checkboxes.\n                $(event.target.parentNode.parentElement).find('input[type=checkbox]:checked').prop(\"checked\", false);\n\n                // Check the default checkbox.\n                $(event.target.parentNode.parentElement).find('input[type=checkbox][value=\"0\"]').prop(\"checked\", true);\n            });\n\n            // Called to override click event to trigger a proper generate request with filtering.\n            var generateWithFilters = function(event) {\n                event.preventDefault();\n\n                var filterParams = event.target.search.substr(1),\n                    newLink = $('#generatereport').attr('formaction') + '&' + filterParams;\n\n                $('#generatereport').attr('formaction', newLink);\n                $('#generatereport').click();\n            };\n\n            // Override 'reset table preferences' so it generates with filters.\n            $('.resettable').on(\"click\", \"a\", function(event) {\n                generateWithFilters(event);\n            });\n\n            // Override table heading sort links so they generate with filters.\n            $('thead').on(\"click\", \"a\", function(event) {\n                generateWithFilters(event);\n            });\n\n            // Override pagination page links so they generate with filters.\n            $('.pagination').on(\"click\", \"a\", function(event) {\n                generateWithFilters(event);\n            });\n\n            /**\n             * Groups filter specific handlers.\n             */\n\n            // Set groups filter button text to include relevant item count (or 'all').\n            var setGroupFilterText = function (groupCount) {\n                var allString = str.get_string('all');\n\n                $.when(allString).done(function(allString){\n                    // Use 'all' if that option is checked.\n                    if ($('#filtergroups0').prop(\"checked\")) {\n                        groupCount = allString.toLowerCase();\n                    }\n\n                   $('#filter_groups_button').text($('#groups_title_base').val() + ' (' + groupCount + ')');\n                });\n            };\n\n            // Control groups filter rules around 'all' option.\n            $('#filter-groups-popover input[name=\"filtergroups[]\"]').on('click', function(event) {\n                // If checking 'all', uncheck others.\n                var filterValue = event.target.value;\n\n                // Uncheck other groups if 'all' selected.\n                if (filterValue == 0) {\n                    if ($('#' + event.target.id).prop('checked')) {\n                        $(event.target.parentNode).find('input[name=\"filtergroups[]\"]:checked').each( function() {\n                            if ($(this).val() != 0) {\n                                $(this).prop('checked', false);\n                            }\n                        });\n                    } else {\n                        // Don't allow unchecking of 'all' directly.\n                        $('#' + event.target.id).prop('checked', true);\n                    }\n                } else {\n                    // Uncheck 'all' if another group is checked.\n                    $('#filtergroups0').prop('checked', false);\n                }\n            });\n\n            // Event handler for showing groups filter popover.\n            $('#filter_groups_button').on('click', function() {\n                // Create popover.\n                var referenceElement = document.querySelector('#filter_groups_button'),\n                    popperContent = document.querySelector('#filter-groups-popover');\n\n                new Popper(referenceElement, popperContent, {placement: 'bottom'});\n\n                // Show popover.\n                $('#filter-groups-popover').removeClass('d-none');\n            });\n\n            // Event handler to save groups filter.\n            $(document).on(\"click\", \".filter-save\", function() {\n                // Close the popover.\n                $('#filter-groups-popover').addClass('d-none');\n\n                // Update group count on button.\n                var groupsCount = $('#filter-groups-popover').find('input[name=\"filtergroups[]\"]:checked').length;\n                setGroupFilterText(groupsCount);\n            });\n        }\n    };\n});\n"],"file":"filters.min.js"}